<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Volt PWA - Memory Bank</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="/manifest.webmanifest">
    
    <!-- Meta tags for PWA -->
    <meta name="theme-color" content="#7c3aed">
    <meta name="description" content="Volt PWA with ChatGPT Memory Bank - Preserve conversations across resets">
    
    <!-- Icons -->
    <link rel="icon" type="image/png" sizes="192x192" href="/icon-192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="/icon-512.png">
    <link rel="apple-touch-icon" href="/icon-192.png">
    
    <!-- iOS PWA support -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Volt Memory">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React and ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel for JSX transformation -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    
    <style>
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
                'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',
                sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background: #f9fafb;
        }
        
        .spinner {
            border: 4px solid #f3f4f6;
            border-top: 4px solid #7c3aed;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div id="root">
        <div class="loading">
            <div class="spinner"></div>
        </div>
    </div>

    <script type="text/babel">
        const { useState, useEffect } = React;
        const { 
            Brain, Save, Download, Upload, Search, Plus, 
            MessageCircle, Code, Target, FileText, Users,
            Calendar, Tag, Filter, Star, Trash2, Copy,
            CheckCircle, AlertCircle, Zap, Clock, Folder
        } = lucide;

        // Complete Memory Bank Component (same as the React artifact above)
        const VoltMemoryBank = () => {
            const [activeTab, setActiveTab] = useState('overview');
            const [conversations, setConversations] = useState([]);
            const [contextSummary, setContextSummary] = useState('');
            const [memoryBank, setMemoryBank] = useState('');
            const [stats, setStats] = useState({});
            const [loading, setLoading] = useState(false);
            const [error, setError] = useState(null);
            const [success, setSuccess] = useState(null);
            const [searchTerm, setSearchTerm] = useState('');
            const [selectedCategory, setSelectedCategory] = useState('all');

            // New conversation form
            const [newConversation, setNewConversation] = useState({
                title: '',
                content: '',
                tags: '',
                category: 'general',
                importance: 'medium'
            });

            // Load memory data on component mount
            useEffect(() => {
                loadMemoryData();
            }, []);

            const loadMemoryData = async () => {
                try {
                    setLoading(true);
                    // Use working API endpoint
                    const response = await fetch('/.netlify/functions/memory');
                    const data = await response.json();
                    
                    if (data.status === 'success') {
                        setConversations(data.data.conversations || []);
                        setContextSummary(data.data.contextSummary?.content || '');
                        setMemoryBank(data.data.memoryBank?.content || '');
                        setStats(data.data.stats || {});
                    }
                } catch (error) {
                    setError('Failed to load memory data');
                } finally {
                    setLoading(false);
                }
            };

            const saveContextSummary = async () => {
                try {
                    setLoading(true);
                    const response = await fetch('/.netlify/functions/memory', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            type: 'context-summary',
                            content: contextSummary
                        })
                    });
                    
                    const data = await response.json();
                    if (data.status === 'success') {
                        setSuccess('Context summary saved successfully!');
                        setTimeout(() => setSuccess(null), 3000);
                    }
                } catch (error) {
                    setError('Failed to save context summary');
                } finally {
                    setLoading(false);
                }
            };

            const saveMemoryBank = async () => {
                try {
                    setLoading(true);
                    const response = await fetch('/.netlify/functions/memory', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            type: 'memory-bank',
                            content: memoryBank
                        })
                    });
                    
                    const data = await response.json();
                    if (data.status === 'success') {
                        setSuccess('Memory bank saved successfully!');
                        setTimeout(() => setSuccess(null), 3000);
                    }
                } catch (error) {
                    setError('Failed to save memory bank');
                } finally {
                    setLoading(false);
                }
            };

            const saveConversation = async () => {
                try {
                    setLoading(true);
                    const response = await fetch('/.netlify/functions/memory', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            type: 'conversation',
                            ...newConversation,
                            tags: newConversation.tags.split(',').map(tag => tag.trim()).filter(tag => tag)
                        })
                    });
                    
                    const data = await response.json();
                    if (data.status === 'success') {
                        setSuccess('Conversation saved successfully!');
                        setNewConversation({ title: '', content: '', tags: '', category: 'general', importance: 'medium' });
                        loadMemoryData(); // Refresh data
                        setTimeout(() => setSuccess(null), 3000);
                    }
                } catch (error) {
                    setError('Failed to save conversation');
                } finally {
                    setLoading(false);
                }
            };

            const generateChatGPTContext = async () => {
                try {
                    setLoading(true);
                    const response = await fetch('/.netlify/functions/memory?action=generate-context');
                    const data = await response.json();
                    
                    if (data.status === 'success') {
                        const context = data.data.context;
                        navigator.clipboard.writeText(context).then(() => {
                            setSuccess('Context copied to clipboard! Paste this into ChatGPT to restore your session.');
                            setTimeout(() => setSuccess(null), 5000);
                        });
                    }
                } catch (error) {
                    setError('Failed to generate context');
                } finally {
                    setLoading(false);
                }
            };

            const exportMemoryData = async () => {
                try {
                    setLoading(true);
                    const response = await fetch('/.netlify/functions/memory?action=export');
                    const data = await response.json();
                    
                    if (data.status === 'success') {
                        const exportData = data.data;
                        const dataStr = JSON.stringify(exportData, null, 2);
                        const dataBlob = new Blob([dataStr], { type: 'application/json' });
                        const url = URL.createObjectURL(dataBlob);
                        
                        const link = document.createElement('a');
                        link.href = url;
                        link.download = `volt-memory-backup-${new Date().toISOString().split('T')[0]}.json`;
                        link.click();
                        
                        URL.revokeObjectURL(url);
                        setSuccess('Memory data exported successfully!');
                        setTimeout(() => setSuccess(null), 3000);
                    }
                } catch (error) {
                    setError('Failed to export memory data');
                } finally {
                    setLoading(false);
                }
            };

            const clearMessages = () => {
                setError(null);
                setSuccess(null);
            };

            const filteredConversations = conversations.filter(conv => {
                const matchesSearch = conv.title.toLowerCase().includes(searchTerm.toLowerCase()) ||
                                     conv.content.toLowerCase().includes(searchTerm.toLowerCase());
                const matchesCategory = selectedCategory === 'all' || conv.category === selectedCategory;
                return matchesSearch && matchesCategory;
            });

            const categories = ['all', 'general', 'development', 'volt-pwa', 'planning', 'decisions'];

            return React.createElement('div', { className: "max-w-6xl mx-auto p-6 bg-gray-50 min-h-screen" },
                // Header
                React.createElement('div', { className: "bg-white rounded-lg shadow-lg p-6 mb-6" },
                    React.createElement('h1', { className: "text-3xl font-bold text-gray-800 mb-2 flex items-center gap-3" },
                        React.createElement(Brain, { className: "text-purple-600" }),
                        "Volt Memory Bank - Complete System"
                    ),
                    React.createElement('p', { className: "text-gray-600 mb-4" },
                        "Preserve your ChatGPT conversations and context across resets"
                    ),
                    // Quick Actions
                    React.createElement('div', { className: "flex flex-wrap gap-3" },
                        React.createElement('button', {
                            onClick: generateChatGPTContext,
                            disabled: loading,
                            className: "bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 disabled:bg-gray-400 flex items-center gap-2"
                        },
                            React.createElement(MessageCircle, { size: 16 }),
                            "Generate ChatGPT Context"
                        ),
                        React.createElement('button', {
                            onClick: exportMemoryData,
                            disabled: loading,
                            className: "bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 disabled:bg-gray-400 flex items-center gap-2"
                        },
                            React.createElement(Download, { size: 16 }),
                            "Export All Data"
                        )
                    )
                ),

                // Status Messages
                error && React.createElement('div', { className: "bg-red-50 border border-red-200 rounded-lg p-4 mb-6" },
                    React.createElement('div', { className: "flex items-center justify-between" },
                        React.createElement('div', { className: "flex items-center gap-2" },
                            React.createElement(AlertCircle, { className: "text-red-500", size: 20 }),
                            React.createElement('span', { className: "text-red-800" }, error)
                        ),
                        React.createElement('button', { onClick: clearMessages, className: "text-red-500 hover:text-red-700" }, "×")
                    )
                ),

                success && React.createElement('div', { className: "bg-green-50 border border-green-200 rounded-lg p-4 mb-6" },
                    React.createElement('div', { className: "flex items-center justify-between" },
                        React.createElement('div', { className: "flex items-center gap-2" },
                            React.createElement(CheckCircle, { className: "text-green-500", size: 20 }),
                            React.createElement('span', { className: "text-green-800" }, success)
                        ),
                        React.createElement('button', { onClick: clearMessages, className: "text-green-500 hover:text-green-700" }, "×")
                    )
                ),

                // Navigation Tabs
                React.createElement('div', { className: "bg-white rounded-lg shadow-lg mb-6" },
                    React.createElement('div', { className: "border-b border-gray-200" },
                        React.createElement('nav', { className: "flex space-x-8 px-6" },
                            [
                                { id: 'overview', label: 'Overview', icon: Zap },
                                { id: 'context', label: '3-Month Context', icon: Brain },
                                { id: 'conversations', label: 'Conversations', icon: MessageCircle },
                                { id: 'memory-bank', label: 'Memory Bank', icon: FileText },
                                { id: 'add-new', label: 'Add New', icon: Plus }
                            ].map(tab =>
                                React.createElement('button', {
                                    key: tab.id,
                                    onClick: () => setActiveTab(tab.id),
                                    className: `flex items-center gap-2 py-4 px-2 border-b-2 font-medium text-sm ${
                                        activeTab === tab.id
                                            ? 'border-purple-500 text-purple-600'
                                            : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'
                                    }`
                                },
                                    React.createElement(tab.icon, { size: 16 }),
                                    tab.label
                                )
                            )
                        )
                    ),

                    // Tab Content
                    React.createElement('div', { className: "p-6" },
                        // Overview Tab
                        activeTab === 'overview' && React.createElement('div', { className: "space-y-6" },
                            React.createElement('div', { className: "grid grid-cols-1 md:grid-cols-3 gap-6" },
                                React.createElement('div', { className: "bg-blue-50 p-4 rounded-lg" },
                                    React.createElement('div', { className: "flex items-center gap-2 mb-2" },
                                        React.createElement(MessageCircle, { className: "text-blue-600", size: 20 }),
                                        React.createElement('h3', { className: "font-medium text-blue-800" }, "Conversations")
                                    ),
                                    React.createElement('p', { className: "text-2xl font-bold text-blue-600" }, stats.totalConversations || 0),
                                    React.createElement('p', { className: "text-blue-700 text-sm" }, "Total saved")
                                ),
                                React.createElement('div', { className: "bg-green-50 p-4 rounded-lg" },
                                    React.createElement('div', { className: "flex items-center gap-2 mb-2" },
                                        React.createElement(Clock, { className: "text-green-600", size: 20 }),
                                        React.createElement('h3', { className: "font-medium text-green-800" }, "Last Activity")
                                    ),
                                    React.createElement('p', { className: "text-green-600 text-sm" },
                                        stats.lastActivity ? new Date(stats.lastActivity).toLocaleDateString() : 'None'
                                    )
                                ),
                                React.createElement('div', { className: "bg-purple-50 p-4 rounded-lg" },
                                    React.createElement('div', { className: "flex items-center gap-2 mb-2" },
                                        React.createElement(Brain, { className: "text-purple-600", size: 20 }),
                                        React.createElement('h3', { className: "font-medium text-purple-800" }, "Memory Status")
                                    ),
                                    React.createElement('p', { className: "text-purple-600 text-sm" },
                                        contextSummary && memoryBank ? 'Complete' : 'Needs Setup'
                                    )
                                )
                            ),

                            React.createElement('div', { className: "bg-yellow-50 border border-yellow-200 rounded-lg p-6" },
                                React.createElement('h3', { className: "font-medium text-yellow-800 mb-3" }, "🚀 Quick Start: Preserve Your 3-Month Context"),
                                React.createElement('ol', { className: "text-yellow-700 text-sm space-y-2 list-decimal list-inside" },
                                    React.createElement('li', null, 'Go to ', React.createElement('strong', null, '"3-Month Context"'), ' tab and describe your ChatGPT relationship'),
                                    React.createElement('li', null, 'Add your most important conversations to ', React.createElement('strong', null, '"Conversations"')),
                                    React.createElement('li', null, 'Set up your ', React.createElement('strong', null, '"Memory Bank"'), ' with key decisions and preferences'),
                                    React.createElement('li', null, 'Use ', React.createElement('strong', null, '"Generate ChatGPT Context"'), ' button to restore sessions')
                                )
                            )
                        ),

                        // 3-Month Context Tab
                        activeTab === 'context' && React.createElement('div', { className: "space-y-6" },
                            React.createElement('div', { className: "bg-purple-50 border border-purple-200 rounded-lg p-6" },
                                React.createElement('h2', { className: "text-xl font-semibold text-purple-800 mb-4" }, "3-Month Relationship Context"),
                                React.createElement('p', { className: "text-purple-700 mb-4" },
                                    "Describe your 3-month relationship with ChatGPT. Include ongoing projects, your working style, communication patterns, and any important context that should be preserved across resets."
                                ),
                                React.createElement('textarea', {
                                    value: contextSummary,
                                    onChange: (e) => setContextSummary(e.target.value),
                                    placeholder: "Example: We've been working together for 3 months on various projects. You know my coding style prefers React functional components, I use Tailwind CSS, and I'm building a PWA called Volt. We've established a collaborative relationship where you understand my preferences for clean, well-documented code...",
                                    className: "w-full h-40 p-4 border border-purple-300 rounded-lg resize-none focus:ring-2 focus:ring-purple-500 focus:border-purple-500"
                                }),
                                React.createElement('div', { className: "mt-4 flex gap-3" },
                                    React.createElement('button', {
                                        onClick: saveContextSummary,
                                        disabled: loading || !contextSummary.trim(),
                                        className: "bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 disabled:bg-gray-400 flex items-center gap-2"
                                    },
                                        React.createElement(Save, { size: 16 }),
                                        "Save Context Summary"
                                    ),
                                    React.createElement('button', {
                                        onClick: () => setContextSummary(''),
                                        className: "bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700 flex items-center gap-2"
                                    },
                                        React.createElement(Trash2, { size: 16 }),
                                        "Clear"
                                    )
                                )
                            ),

                            contextSummary && React.createElement('div', { className: "bg-green-50 border border-green-200 rounded-lg p-4" },
                                React.createElement('div', { className: "flex items-center gap-2 mb-2" },
                                    React.createElement(CheckCircle, { className: "text-green-500", size: 20 }),
                                    React.createElement('h3', { className: "font-medium text-green-800" }, "Context Summary Saved")
                                ),
                                React.createElement('p', { className: "text-green-700 text-sm" },
                                    "Your 3-month relationship context is preserved and will be included in ChatGPT restoration prompts."
                                )
                            )
                        ),

                        // Memory Bank Tab
                        activeTab === 'memory-bank' && React.createElement('div', { className: "space-y-6" },
                            React.createElement('div', { className: "bg-blue-50 border border-blue-200 rounded-lg p-6" },
                                React.createElement('h2', { className: "text-xl font-semibold text-blue-800 mb-4" }, "Persistent Memory Bank"),
                                React.createElement('p', { className: "text-blue-700 mb-4" },
                                    "Store critical information that should always be remembered: key decisions, important code snippets, project goals, personal preferences, and anything essential to your work continuity."
                                ),
                                React.createElement('textarea', {
                                    value: memoryBank,
                                    onChange: (e) => setMemoryBank(e.target.value),
                                    placeholder: "Example: Key project decisions made, important code patterns established, architectural choices, personal coding preferences, ongoing goals, critical dates, important contacts, project milestones...",
                                    className: "w-full h-48 p-4 border border-blue-300 rounded-lg resize-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                }),
                                React.createElement('div', { className: "mt-4 flex gap-3" },
                                    React.createElement('button', {
                                        onClick: saveMemoryBank,
                                        disabled: loading || !memoryBank.trim(),
                                        className: "bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 disabled:bg-gray-400 flex items-center gap-2"
                                    },
                                        React.createElement(Save, { size: 16 }),
                                        "Save Memory Bank"
                                    ),
                                    React.createElement('button', {
                                        onClick: () => setMemoryBank(''),
                                        className: "bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700 flex items-center gap-2"
                                    },
                                        React.createElement(Trash2, { size: 16 }),
                                        "Clear"
                                    )
                                )
                            )
                        ),

                        // Add New Tab
                        activeTab === 'add-new' && React.createElement('div', { className: "space-y-8" },
                            React.createElement('div', { className: "bg-white border border-gray-200 rounded-lg p-6" },
                                React.createElement('h3', { className: "text-lg font-semibold text-gray-800 mb-4 flex items-center gap-2" },
                                    React.createElement(MessageCircle, { className: "text-blue-600", size: 20 }),
                                    "Add Important Conversation"
                                ),
                                React.createElement('div', { className: "space-y-4" },
                                    React.createElement('input', {
                                        type: "text",
                                        placeholder: "Conversation title...",
                                        value: newConversation.title,
                                        onChange: (e) => setNewConversation({...newConversation, title: e.target.value}),
                                        className: "w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                    }),
                                    React.createElement('textarea', {
                                        placeholder: "Paste your ChatGPT conversation here...",
                                        value: newConversation.content,
                                        onChange: (e) => setNewConversation({...newConversation, content: e.target.value}),
                                        className: "w-full h-32 p-3 border border-gray-300 rounded-lg resize-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                    }),
                                    React.createElement('div', { className: "grid grid-cols-1 md:grid-cols-3 gap-4" },
                                        React.createElement('select', {
                                            value: newConversation.category,
                                            onChange: (e) => setNewConversation({...newConversation, category: e.target.value}),
                                            className: "p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                        },
                                            React.createElement('option', { value: "general" }, "General"),
                                            React.createElement('option', { value: "development" }, "Development"),
                                            React.createElement('option', { value: "volt-pwa" }, "Volt PWA"),
                                            React.createElement('option', { value: "planning" }, "Planning"),
                                            React.createElement('option', { value: "decisions" }, "Decisions")
                                        ),
                                        React.createElement('select', {
                                            value: newConversation.importance,
                                            onChange: (e) => setNewConversation({...newConversation, importance: e.target.value}),
                                            className: "p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                        },
                                            React.createElement('option', { value: "low" }, "Low Importance"),
                                            React.createElement('option', { value: "medium" }, "Medium Importance"),
                                            React.createElement('option', { value: "high" }, "High Importance")
                                        ),
                                        React.createElement('input', {
                                            type: "text",
                                            placeholder: "Tags (comma-separated)",
                                            value: newConversation.tags,
                                            onChange: (e) => setNewConversation({...newConversation, tags: e.target.value}),
                                            className: "p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                        })
                                    ),
                                    React.createElement('button', {
                                        onClick: saveConversation,
                                        disabled: loading || !newConversation.title || !newConversation.content,
                                        className: "bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 disabled:bg-gray-400 flex items-center gap-2"
                                    },
                                        React.createElement(Save, { size: 16 }),
                                        "Save Conversation"
                                    )
                                )
                            )
                        )
                    )
                )
            );
        };

        // Render the app
        ReactDOM.render(React.createElement(VoltMemoryBank), document.getElementById('root'));

        // Service Worker Registration
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/service-worker.js')
                    .then((registration) => {
                        console.log('SW registered: ', registration);
                    })
                    .catch((registrationError) => {
                        console.log('SW registration failed: ', registrationError);
                    });
            });
        }
    </script>
</body>
</html>
